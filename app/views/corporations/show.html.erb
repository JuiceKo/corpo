<%= stylesheet_link_tag "index" %>
<%= javascript_include_tag "show_corporations", type: :module %>

<div class="container mx-auto px-4">
  <div class="flex flex-col md:flex-row justify-between items-start md:items-center">
    <h1 class="text-3xl font-bold mb-2 md:mb-0">Adhérents</h1>
    <a href="<%= root_path %>" class="button-primary">Retour à l'accueil</a>
  </div>
  <p class="text-sm mb-4">Exercices en cours :  <%= @selected_year %></p>

  <div class="flex mb-4">
    <%= search_form_for @q, url: corporation_path(@corporation), html: { class: "search-form flex-1", id: "combined-form" } do |f| %>
      <div class="flex">
        <%= f.search_field :nom_or_numero_adherent_cont, placeholder: "Rechercher par nom ou numéro adhérent", class: "w-full px-4 py-2 rounded border border-gray-300" %>
        <%= hidden_field_tag :selected_year, @selected_year %>
        <%= check_box_tag "show_all_adherents", 1, params[:show_all_adherents], id: "show_all_adherents", class: "mr-2" %>
        <%= label_tag "show_all_adherents", "Afficher tous les adhérents", class: "pt-2" %>
        <%= f.submit "Rechercher", class: "button-primary ml-2" %>
      </div>
    <% end %>
    <%= link_to "Créer un formulaire avec un nouvel adhérent", new_avec_adherent_corporation_adherents_path(@corporation), data: { turbo: false }, class: "button-primary ml-2" %>
  </div>

  <table class="min-w-full divide-y divide-gray-200">
    <thead>
    <tr>
      <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-2/5">Nom</th>
      <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-1/5">Année</th>
      <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-2/5">Actions</th>
    </tr>
    </thead>
    <tbody>
    <% @adherents.each do |adherent| %>
      <tr class="bg-white">
        <td class="px-6 py-4 whitespace-nowrap w-2/5"><%= adherent.nom.capitalize %></td>
        <td class="px-6 py-4 whitespace-nowrap w-1/5">
          <%= form_tag(corporation_adherent_formulaire_path(@corporation, adherent, annee: ""), method: "get", class: "flex flex-wrap justify-between") do %>
            <div>
              <%= select_tag "annee", options_for_select(@adherent_years[adherent.id]), class: "form-select rounded-md", id: "year-select-#{adherent.id}", onchange: "updateYearSelect(this)" %>
            </div>
        </td>
        <td class="px-6 py-4 whitespace-nowrap w-2/5">
            <div class="flex">
              <%= submit_tag "Voir", name: "voir", class: "button-primary mr-2" %>
              <% if @adherent_years[adherent.id].include?(params[:selected_year]) %>
                <%= link_to "Créer un formulaire", "#", class: "button-disabled mr-2", data: { disable_with: "Processing...", tooltip: "Ce bouton est actuellement désactivé" } %>
              <% else %>
                <%= link_to "Créer un formulaire", new_corporation_adherent_formulaire_path(@corporation, adherent), class: "button-primary mr-2" %>
              <% end %>
              <%= link_to 'Télécharger PDF', corporation_adherent_formulaire_path(@corporation, adherent, annee: @selected_year, telecharger: true), class: 'bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 ml-2 rounded', id: 'download-link' %>
            </div>
          <% end %>
        </td>
      </tr>
      <tr>
        <td colspan="3" class="h-px gradient-line"></td>
      </tr>
    <% end %>
    </tbody>
  </table>


</div>